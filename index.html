<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Test Tayyorlov</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            color: #fff;
            min-height: 100vh;
        }

        /* ===== MAIN MENU ===== */
        .menu-screen {
            padding: 40px 20px;
            max-width: 500px;
            margin: 0 auto;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #e91e8c 0%, #f06292 100%);
            border-radius: 20px;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 10px 40px rgba(233, 30, 140, 0.3);
        }

        .app-title {
            font-size: 32px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 8px;
        }

        .app-subtitle {
            text-align: center;
            color: #8b8b9e;
            font-size: 14px;
            margin-bottom: 32px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 12px;
        }

        .stat-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .stat-icon.total { border: 2px solid #a855f7; color: #a855f7; }
        .stat-icon.correct { border: 2px solid #00d4aa; color: #00d4aa; }
        .stat-icon.wrong { border: 2px solid #f87171; color: #f87171; }
        .stat-icon.percent { color: #fbbf24; }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: #8b8b9e;
        }

        /* Mode Cards */
        .mode-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mode-card {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .mode-card:active {
            transform: scale(0.98);
        }

        .mode-card.blue { background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); }
        .mode-card.purple { background: linear-gradient(135deg, #9333ea 0%, #a855f7 100%); }
        .mode-card.green { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .mode-card.red { background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); }

        .mode-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 16px;
        }

        .mode-info {
            flex: 1;
        }

        .mode-title {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .mode-desc {
            font-size: 13px;
            opacity: 0.8;
        }

        .mode-arrow {
            font-size: 20px;
            opacity: 0.7;
        }

        .mode-chips {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .mode-chip {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            color: white;
            font-family: inherit;
        }

        .mode-chip:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .footer {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 32px;
        }

        /* ===== QUIZ SCREEN - LEARNING MODE ===== */
        .quiz-screen {
            display: none;
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 100px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .home-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8b8b9e;
            font-size: 15px;
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
        }

        .quiz-counter {
            color: #8b8b9e;
            font-size: 15px;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .search-input {
            flex: 1;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
        }

        .search-input input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: white;
            font-size: 15px;
            margin-left: 10px;
            font-family: inherit;
        }

        .search-input input::placeholder {
            color: #666;
        }

        .hash-btn, .go-btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            border: none;
        }

        .hash-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #8b8b9e;
        }

        .go-btn {
            background: #2563eb;
            color: white;
        }

        /* Progress Bar */
        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4aa 0%, #00d4aa 100%);
            border-radius: 2px;
            transition: width 0.3s;
        }

        .progress-fill.gradient {
            background: linear-gradient(90deg, #e91e8c 0%, #00d4aa 100%);
        }

        /* Question Card */
        .question-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
        }

        .question-badge {
            background: #6366f1;
            color: white;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.5;
        }

        /* Answers */
        .answers {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .answer-item:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .answer-item.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .answer-item.correct {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.15);
        }

        .answer-item.wrong {
            border-color: #f87171;
            background: rgba(248, 113, 113, 0.15);
        }

        .answer-letter {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 14px;
            flex-shrink: 0;
        }

        .answer-item.selected .answer-letter {
            background: #fbbf24;
            color: #000;
        }

        .answer-item.correct .answer-letter {
            background: #00d4aa;
            color: #000;
        }

        .answer-item.wrong .answer-letter {
            background: #f87171;
            color: #fff;
        }

        .answer-text {
            font-size: 15px;
            line-height: 1.5;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-check {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 24px;
            background: #2563eb;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
        }

        .btn-show {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 24px;
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
        }

        .btn-pink {
            background: linear-gradient(135deg, #e91e8c 0%, #f06292 100%);
            padding: 16px 48px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 35, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            display: none;
        }

        .nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #8b8b9e;
            font-size: 14px;
            cursor: pointer;
            font-family: inherit;
        }

        .nav-btn:disabled {
            opacity: 0.4;
        }

        .nav-btn.primary {
            background: #2563eb;
            border-color: #2563eb;
            color: white;
        }

        .nav-btn-center {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #8b8b9e;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        /* ===== TEST MODE HEADER ===== */
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .test-stats {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .test-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 15px;
        }

        .test-stat.correct { color: #00d4aa; }
        .test-stat.wrong { color: #f87171; }
        .test-stat.time { color: #8b8b9e; }

        .test-counter {
            text-align: center;
            color: #8b8b9e;
            font-size: 14px;
            margin-bottom: 16px;
        }

        /* Center check button */
        .center-btn {
            display: flex;
            justify-content: center;
            margin-top: 24px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 70vh;
            overflow: hidden;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            color: #8b8b9e;
            cursor: pointer;
            font-size: 18px;
        }

        .modal-body {
            padding: 16px;
            overflow-y: auto;
            max-height: calc(70vh - 80px);
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .q-item {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .q-item.current {
            background: #2563eb;
            border-color: #2563eb;
        }

        .q-item.answered-correct {
            background: #00d4aa;
            border-color: #00d4aa;
            color: #000;
        }

        .q-item.answered-wrong {
            background: #f87171;
            border-color: #f87171;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- MAIN MENU -->
    <div class="menu-screen" id="menuScreen">
        <div class="logo">üìñ</div>
        <h1 class="app-title">Test Tayyorlov</h1>
        <p class="app-subtitle">AKT va Axborot Tizimlari fanidan testlar</p>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon total">‚óé</div>
                <div class="stat-value" id="totalCount">200</div>
                <div class="stat-label">Jami testlar</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon correct">‚úì</div>
                <div class="stat-value" id="correctCount">0</div>
                <div class="stat-label">To'g'ri javoblar</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon wrong">‚úï</div>
                <div class="stat-value" id="wrongCount">0</div>
                <div class="stat-label">Xato javoblar</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon percent">‚òÜ</div>
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">Aniqlik</div>
            </div>
        </div>

        <div class="mode-cards">
            <div class="mode-card blue" onclick="startMode('learn')">
                <div class="mode-icon">üìñ</div>
                <div class="mode-info">
                    <div class="mode-title">O'rganish rejimi</div>
                    <div class="mode-desc">Savollar va javoblarni ko'rib chiqish</div>
                </div>
                <div class="mode-arrow">‚Ä∫</div>
            </div>

            <div class="mode-card purple" onclick="startMode('all')">
                <div class="mode-icon">‚óé</div>
                <div class="mode-info">
                    <div class="mode-title">Barcha testlar</div>
                    <div class="mode-desc" id="allTestsDesc">200 ta savolga javob bering</div>
                </div>
                <div class="mode-arrow">‚Ä∫</div>
            </div>

            <div class="mode-card green" onclick="startMode('random', 20)">
                <div class="mode-icon">‚ö°</div>
                <div class="mode-info">
                    <div class="mode-title">Tasodifiy test</div>
                    <div class="mode-desc">20 ta tasodifiy savol</div>
                    <div class="mode-chips">
                        <button class="mode-chip" onclick="event.stopPropagation(); startMode('random', 10)">10 ta</button>
                        <button class="mode-chip" onclick="event.stopPropagation(); startMode('random', 30)">30 ta</button>
                        <button class="mode-chip" onclick="event.stopPropagation(); startMode('random', 50)">50 ta</button>
                    </div>
                </div>
                <div class="mode-arrow">‚Ä∫</div>
            </div>

            <div class="mode-card red" id="wrongCard" style="display: none;" onclick="startMode('wrong')">
                <div class="mode-icon">‚Ü∫</div>
                <div class="mode-info">
                    <div class="mode-title">Xatolarni takrorlash</div>
                    <div class="mode-desc" id="wrongTestsDesc">0 ta xato savol</div>
                </div>
                <div class="mode-arrow">‚Ä∫</div>
            </div>
        </div>

        <div class="footer">Magistratura - TJBAKT mutaxassisligi</div>
    </div>

    <!-- QUIZ SCREEN - LEARNING MODE -->
    <div class="quiz-screen" id="quizLearn">
        <div class="quiz-header">
            <button class="home-btn" onclick="goHome()">üè† Bosh sahifa</button>
            <div class="quiz-counter" id="learnCounter">1 / 200</div>
        </div>

        <div class="search-bar">
            <div class="search-input">
                <span>üîç</span>
                <input type="text" placeholder="Savol qidirish..." id="searchInput">
            </div>
            <button class="hash-btn" onclick="showNumberInput()">#</button>
            <button class="go-btn" onclick="goToSearch()">O'tish</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="learnProgress"></div>
        </div>

        <div class="question-card">
            <div class="question-header">
                <div class="question-badge" id="learnBadge">1</div>
                <div class="question-text" id="learnQuestion">Savol matni</div>
            </div>
            <div class="answers" id="learnAnswers"></div>
            <div class="action-buttons">
                <button class="btn-check" onclick="checkAnswer()">‚úì Tekshirish</button>
                <button class="btn-show" onclick="showAnswer()">‚ö° <span id="showBtnText">Javobni ko'rish</span></button>
            </div>
        </div>
    </div>

    <!-- QUIZ SCREEN - TEST MODE -->
    <div class="quiz-screen" id="quizTest">
        <div class="test-header">
            <button class="home-btn" onclick="goHome()">üè†</button>
            <div class="test-stats">
                <div class="test-stat correct">‚úì <span id="testCorrect">0</span></div>
                <div class="test-stat wrong">‚úï <span id="testWrong">0</span></div>
                <div class="test-stat time">‚è± <span id="testTime">00:00</span></div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill gradient" id="testProgress"></div>
        </div>

        <div class="test-counter" id="testCounter">1 / 50</div>

        <div class="question-card">
            <div class="question-header">
                <div class="question-badge" id="testBadge">#1</div>
                <div class="question-text" id="testQuestion">Savol matni</div>
            </div>
            <div class="answers" id="testAnswers"></div>
            <div class="center-btn">
                <button class="btn-check btn-pink" onclick="checkTestAnswer()">Tekshirish</button>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <div class="bottom-nav" id="bottomNav">
        <div class="nav-row">
            <button class="nav-btn" id="prevBtn" onclick="prevQuestion()">‚Äπ Oldingi</button>
            <button class="nav-btn-center" onclick="showQuestionList()">‚ò∞</button>
            <button class="nav-btn primary" onclick="nextQuestion()">Keyingi ‚Ä∫</button>
        </div>
    </div>

    <!-- QUESTION LIST MODAL -->
    <div class="modal" id="questionModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Savollar ro'yxati</div>
                <button class="modal-close" onclick="hideQuestionList()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="question-grid" id="questionGrid"></div>
            </div>
        </div>
    </div>

    <!-- NUMBER INPUT MODAL -->
    <div class="modal" id="numberModal">
        <div class="modal-content" style="max-width: 300px;">
            <div class="modal-header">
                <div class="modal-title">Savol raqami</div>
                <button class="modal-close" onclick="hideNumberInput()">‚úï</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <input type="number" id="numberInput" style="width: 100%; padding: 16px; font-size: 24px; text-align: center; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; margin-bottom: 16px;" placeholder="1">
                <button class="go-btn" style="width: 100%;" onclick="goToNumber()">O'tish</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Data
        let questions = [];
        let currentMode = '';
        let currentIndex = 0;
        let selectedAnswer = null;
        let answerShown = false;
        let stats = { correct: 0, wrong: 0 };
        let wrongQuestions = [];
        let testQuestions = [];
        let timerInterval = null;
        let seconds = 0;
        let questionResults = {};

        // Initialize
        function init() {
            questions = getQuestions();
            document.getElementById('totalCount').textContent = questions.length;
            document.getElementById('allTestsDesc').textContent = `${questions.length} ta savolga javob bering`;
            loadStats();
            updateMenu();
        }

        function getQuestions() {
            return [
                { id: 1, question: "Spiralli modelda har bir iteratsiya nima sifatida tasvirlanadi?", answers: ["Spiralli modelda har bir iteratsiya ishlab chiqishning tugatilgan tsikli sifatida tasvirlanadi", "Spiralli modelda har bir iteratsiya ishlab chiqishning oraliq tsikli sifatida tasvirlanadi", "Spiralli modelda har bir iteratsiya ishlab chiqishning tahliliy tsikli sifatida tasvirlanadi", "Spiralli modelda har bir iteratsiya ishlab chiqishning sintez tsikli sifatida tasvirlanadi"], correct: 0 },
                { id: 2, question: "Hayotiy tsiklning spiral modeli kaskadli modeldan nima bilan farq qiladi?", answers: ["Spiral model loyihalashning uch bosqichini belgilaydi", "Kaskadli model loyihalashnin 4 bosqichini belgilaydi", "Spiral model axborot tizimini ishlab chiqishda iteratsion jarayonni nazarda tutadi", "Spiral model AS ishlab chiqishning algoritmik metodini belgilaydi"], correct: 2 },
                { id: 3, question: "Masalani qo'yilishi g'oyasini shakllantirish qaysi fazaga tegishli?", answers: ["Ishlab chiqish fazasi", "Kontseptual faza", "Loyihaviy faza", "Kuzatish"], correct: 1 },
                { id: 4, question: "Dasturiy ta'minot arxitekturasi nima?", answers: ["Dastur kodi", "Tizim tuzilmasi va komponentlar orasidagi munosabatlar", "Foydalanuvchi interfeysi", "Ma'lumotlar bazasi strukturasi"], correct: 1 },
                { id: 5, question: "Agile metodologiyasining asosiy tamoyili nima?", answers: ["Batafsil hujjatlashtirish", "Mijoz bilan hamkorlik va o'zgarishlarga moslashuvchanlik", "Qat'iy rejalashtirish", "Uzun rivojlanish tsikllari"], correct: 1 },
                { id: 6, question: "Unit testing nima?", answers: ["Butun tizimni sinash", "Alohida modullarni yoki funksiyalarni sinash", "Foydalanuvchi interfeysini sinash", "Ma'lumotlar bazasini sinash"], correct: 1 },
                { id: 7, question: "Git nima uchun ishlatiladi?", answers: ["Kod yozish uchun", "Versiyalarni boshqarish va kod tarixini saqlash", "Dasturni ishga tushirish", "Ma'lumotlarni saqlash"], correct: 1 },
                { id: 8, question: "REST API nima?", answers: ["Dasturlash tili", "HTTP protokoli asosida ishlaydigan veb xizmatlar arxitekturasi", "Ma'lumotlar bazasi", "Operatsion tizim"], correct: 1 },
                { id: 9, question: "SQL injection nima?", answers: ["Ma'lumotlar bazasi turi", "Zararli SQL kodini kiritish orqali xavfsizlik zaifligidan foydalanish", "Dasturlash usuli", "Test turi"], correct: 1 },
                { id: 10, question: "Scrum metodologiyasida Sprint nima?", answers: ["Doimiy jarayon", "1-4 haftalik vaqt chegaralangan iteratsiya", "Hujjat turi", "Test bosqichi"], correct: 1 },
                { id: 11, question: "Docker nima uchun ishlatiladi?", answers: ["Kod yozish uchun", "Ilovalarni konteynerlashtirish va portativ qilish", "Ma'lumotlar bazasi", "Tarmoq sozlash"], correct: 1 },
                { id: 12, question: "CI/CD nima?", answers: ["Dasturlash tili", "Uzluksiz integratsiya va uzluksiz yetkazib berish", "Ma'lumotlar bazasi", "Xavfsizlik tizimi"], correct: 1 }
            ];
        }

        function loadStats() {
            try {
                const saved = localStorage.getItem('testStats');
                if (saved) {
                    const data = JSON.parse(saved);
                    stats = data.stats || { correct: 0, wrong: 0 };
                    wrongQuestions = data.wrong || [];
                }
            } catch(e) {}
        }

        function saveStats() {
            try {
                localStorage.setItem('testStats', JSON.stringify({ stats, wrong: wrongQuestions }));
            } catch(e) {}
        }

        function updateMenu() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('wrongCount').textContent = stats.wrong;
            const total = stats.correct + stats.wrong;
            const acc = total > 0 ? Math.round((stats.correct / total) * 100) : 0;
            document.getElementById('accuracy').textContent = acc + '%';

            if (wrongQuestions.length > 0) {
                document.getElementById('wrongCard').style.display = 'flex';
                document.getElementById('wrongTestsDesc').textContent = `${wrongQuestions.length} ta xato savol`;
            } else {
                document.getElementById('wrongCard').style.display = 'none';
            }
        }

        function shuffle(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function startMode(mode, count) {
            currentMode = mode;
            currentIndex = 0;
            selectedAnswer = null;
            answerShown = false;
            questionResults = {};

            if (mode === 'learn') {
                testQuestions = [...questions];
                document.getElementById('menuScreen').style.display = 'none';
                document.getElementById('quizLearn').style.display = 'block';
                document.getElementById('bottomNav').style.display = 'block';
                renderLearnQuestion();
            } else if (mode === 'all') {
                testQuestions = shuffle([...questions]);
                startTestMode();
            } else if (mode === 'random') {
                testQuestions = shuffle([...questions]).slice(0, count);
                startTestMode();
            } else if (mode === 'wrong') {
                testQuestions = wrongQuestions.map(id => questions.find(q => q.id === id)).filter(Boolean);
                if (testQuestions.length === 0) {
                    alert('Xato savollar yo\'q');
                    return;
                }
                startTestMode();
            }
        }

        function startTestMode() {
            seconds = 0;
            document.getElementById('testCorrect').textContent = '0';
            document.getElementById('testWrong').textContent = '0';
            document.getElementById('testTime').textContent = '00:00';
            
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('quizTest').style.display = 'block';
            document.getElementById('bottomNav').style.display = 'none';
            
            startTimer();
            renderTestQuestion();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('testTime').textContent = `${m}:${s}`;
            }, 1000);
        }

        function renderLearnQuestion() {
            const q = testQuestions[currentIndex];
            const total = testQuestions.length;
            
            document.getElementById('learnCounter').textContent = `${currentIndex + 1} / ${total}`;
            document.getElementById('learnBadge').textContent = currentIndex + 1;
            document.getElementById('learnQuestion').textContent = q.question;
            document.getElementById('learnProgress').style.width = ((currentIndex + 1) / total * 100) + '%';
            
            selectedAnswer = null;
            answerShown = false;
            document.getElementById('showBtnText').textContent = "Javobni ko'rish";
            
            const list = document.getElementById('learnAnswers');
            list.innerHTML = '';
            q.answers.forEach((ans, i) => {
                const div = document.createElement('div');
                div.className = 'answer-item';
                div.innerHTML = `<div class="answer-letter">${String.fromCharCode(65 + i)}</div><div class="answer-text">${ans}</div>`;
                div.onclick = () => selectLearnAnswer(i);
                list.appendChild(div);
            });
            
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            buildQuestionGrid();
        }

        function selectLearnAnswer(i) {
            if (answerShown) return;
            selectedAnswer = i;
            document.querySelectorAll('#learnAnswers .answer-item').forEach((item, idx) => {
                item.classList.toggle('selected', idx === i);
            });
        }

        function checkAnswer() {
            if (selectedAnswer === null) {
                alert('Javobni tanlang!');
                return;
            }
            showAnswerResult();
        }

        function showAnswer() {
            if (answerShown) {
                answerShown = false;
                document.getElementById('showBtnText').textContent = "Javobni ko'rish";
                renderLearnQuestion();
                return;
            }
            showAnswerResult();
        }

        function showAnswerResult() {
            answerShown = true;
            document.getElementById('showBtnText').textContent = "Yashirish";
            
            const q = testQuestions[currentIndex];
            document.querySelectorAll('#learnAnswers .answer-item').forEach((item, i) => {
                item.classList.remove('selected');
                if (i === q.correct) {
                    item.classList.add('correct');
                } else if (i === selectedAnswer && i !== q.correct) {
                    item.classList.add('wrong');
                }
            });
        }

        function renderTestQuestion() {
            const q = testQuestions[currentIndex];
            const total = testQuestions.length;
            
            document.getElementById('testCounter').textContent = `${currentIndex + 1} / ${total}`;
            document.getElementById('testBadge').textContent = `#${q.id}`;
            document.getElementById('testQuestion').textContent = q.question;
            document.getElementById('testProgress').style.width = ((currentIndex + 1) / total * 100) + '%';
            
            selectedAnswer = null;
            
            const list = document.getElementById('testAnswers');
            list.innerHTML = '';
            q.answers.forEach((ans, i) => {
                const div = document.createElement('div');
                div.className = 'answer-item';
                div.innerHTML = `<div class="answer-letter">${String.fromCharCode(65 + i)}</div><div class="answer-text">${ans}</div>`;
                div.onclick = () => selectTestAnswer(i);
                list.appendChild(div);
            });
        }

        function selectTestAnswer(i) {
            selectedAnswer = i;
            document.querySelectorAll('#testAnswers .answer-item').forEach((item, idx) => {
                item.classList.toggle('selected', idx === i);
            });
        }

        function checkTestAnswer() {
            if (selectedAnswer === null) {
                alert('Javobni tanlang!');
                return;
            }
            
            const q = testQuestions[currentIndex];
            const isCorrect = selectedAnswer === q.correct;
            
            document.querySelectorAll('#testAnswers .answer-item').forEach((item, i) => {
                item.classList.remove('selected');
                if (i === q.correct) {
                    item.classList.add('correct');
                } else if (i === selectedAnswer) {
                    item.classList.add('wrong');
                }
            });
            
            questionResults[currentIndex] = isCorrect;
            
            if (isCorrect) {
                stats.correct++;
                document.getElementById('testCorrect').textContent = Object.values(questionResults).filter(v => v).length;
                wrongQuestions = wrongQuestions.filter(id => id !== q.id);
                try { tg.HapticFeedback.notificationOccurred('success'); } catch(e) {}
            } else {
                stats.wrong++;
                document.getElementById('testWrong').textContent = Object.values(questionResults).filter(v => !v).length;
                if (!wrongQuestions.includes(q.id)) wrongQuestions.push(q.id);
                try { tg.HapticFeedback.notificationOccurred('error'); } catch(e) {}
            }
            
            saveStats();
            
            setTimeout(() => {
                if (currentIndex < testQuestions.length - 1) {
                    currentIndex++;
                    renderTestQuestion();
                } else {
                    finishTest();
                }
            }, 1000);
        }

        function finishTest() {
            if (timerInterval) clearInterval(timerInterval);
            
            const correct = Object.values(questionResults).filter(v => v).length;
            const wrong = Object.values(questionResults).filter(v => !v).length;
            const pct = Math.round((correct / testQuestions.length) * 100);
            
            alert(`Test yakunlandi!\n\nTo'g'ri: ${correct}\nNoto'g'ri: ${wrong}\nAniqlik: ${pct}%`);
            goHome();
        }

        function nextQuestion() {
            if (currentIndex < testQuestions.length - 1) {
                currentIndex++;
                renderLearnQuestion();
            }
        }

        function prevQuestion() {
            if (currentIndex > 0) {
                currentIndex--;
                renderLearnQuestion();
            }
        }

        function goHome() {
            if (timerInterval) clearInterval(timerInterval);
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('quizLearn').style.display = 'none';
            document.getElementById('quizTest').style.display = 'none';
            document.getElementById('bottomNav').style.display = 'none';
            updateMenu();
        }

        function buildQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            testQuestions.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'q-item';
                if (i === currentIndex) div.classList.add('current');
                div.textContent = i + 1;
                div.onclick = () => {
                    currentIndex = i;
                    renderLearnQuestion();
                    hideQuestionList();
                };
                grid.appendChild(div);
            });
        }

        function showQuestionList() {
            document.getElementById('questionModal').classList.add('show');
        }

        function hideQuestionList() {
            document.getElementById('questionModal').classList.remove('show');
        }

        function showNumberInput() {
            document.getElementById('numberModal').classList.add('show');
            document.getElementById('numberInput').value = '';
            document.getElementById('numberInput').focus();
        }

        function hideNumberInput() {
            document.getElementById('numberModal').classList.remove('show');
        }

        function goToNumber() {
            const num = parseInt(document.getElementById('numberInput').value);
            if (num >= 1 && num <= testQuestions.length) {
                currentIndex = num - 1;
                renderLearnQuestion();
                hideNumberInput();
            } else {
                alert(`1 dan ${testQuestions.length} gacha raqam kiriting`);
            }
        }

        function goToSearch() {
            const val = document.getElementById('searchInput').value.trim();
            const num = parseInt(val);
            if (num >= 1 && num <= testQuestions.length) {
                currentIndex = num - 1;
                renderLearnQuestion();
                document.getElementById('searchInput').value = '';
            } else if (val) {
                const idx = testQuestions.findIndex(q => q.question.toLowerCase().includes(val.toLowerCase()));
                if (idx !== -1) {
                    currentIndex = idx;
                    renderLearnQuestion();
                    document.getElementById('searchInput').value = '';
                }
            }
        }

        document.getElementById('numberInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') goToNumber();
        });

        document.getElementById('searchInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') goToSearch();
        });

        document.getElementById('questionModal').addEventListener('click', e => {
            if (e.target.id === 'questionModal') hideQuestionList();
        });

        document.getElementById('numberModal').addEventListener('click', e => {
            if (e.target.id === 'numberModal') hideNumberInput();
        });

        init();
    </script>
</body>
</html>
